/* Solitaire + Spider — Arcade Glass Theme (unified) */
.app-solitaire {
    --sol-accent: #3ec8ff;
    --sol-accent-strong: #4ef0d9;
    --sol-panel: rgba(6, 14, 28, 0.55);
    --sol-header-h: 46px;

    background-color: #050a14;
    background-image:
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
        radial-gradient(circle at center, transparent 60%, rgba(0, 0, 0, 0.8) 100%),
        linear-gradient(0deg, rgba(62, 200, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(62, 200, 255, 0.1) 1px, transparent 1px),
        linear-gradient(160deg, rgba(255, 255, 255, 0.03) 0%, transparent 40%),
        radial-gradient(circle at 50% 30%, #1a2c4e 0%, #081020 90%);
    background-size:
        100% 4px,
        100% 100%,
        40px 40px,
        40px 40px,
        100% 100%,
        100% 100%;
    background-position:
        0 0,
        0 0,
        center bottom,
        center bottom,
        0 0,
        0 0;

    display: flex;
    flex-direction: column;
    overflow: hidden;
    color: #e6f1ff;
    font-family: 'Courier New', Courier, monospace;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
    box-shadow: inset 0 0 60px rgba(62, 200, 255, 0.1);
}

/* Header */
.sol-header {
    height: var(--sol-header-h);
    min-height: var(--sol-header-h);
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    align-items: center;
    gap: 10px;
    padding: 0 10px;
    padding-top: env(safe-area-inset-top, 0px);
    background: rgba(0,0,0,0.38);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    z-index: 50;
}

.sol-title {
    justify-self: center;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: #e6f1ff;
    text-shadow: 0 0 10px rgba(62, 200, 255, 0.25);
    white-space: nowrap;
}

.sol-actions {
    display: flex;
    gap: 10px;
    justify-self: end;
    align-items: center;
}

.sol-icon-btn {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.16);
    color: rgba(230, 241, 255, 0.9);
    width: 34px;
    height: 30px;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: transform 0.12s ease, background 0.12s ease, border-color 0.12s ease;
}
.sol-icon-btn:active { transform: translateY(1px) scale(0.98); }

/* Action buttons (Solitaire) */
.sol-action-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    height: 32px;
    padding: 0 10px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.16);
    color: rgba(230, 241, 255, 0.92);
    cursor: pointer;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: transform 0.12s ease, background 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
    font-size: 12px;
    letter-spacing: 0.3px;
    white-space: nowrap;
}
.sol-action-btn svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
    opacity: 0.95;
}
.sol-action-btn.is-compact {
    width: 34px;
    padding: 0;
    justify-content: center;
    gap: 0;
}
.sol-action-btn.is-compact .sol-action-label { display: none; }

.sol-action-btn:hover {
    background: rgba(255, 255, 255, 0.10);
    border-color: rgba(255, 255, 255, 0.22);
    box-shadow: 0 0 0 1px rgba(62, 200, 255, 0.06) inset;
}
.sol-action-btn:active { transform: translateY(1px) scale(0.98); }

@media (max-width: 420px) {
    .sol-action-btn .sol-action-label { display: none; }
    .sol-action-btn { width: 34px; padding: 0; justify-content: center; }
}

/* Hint feedback */
.card.sol-hint-src .card-front {
    box-shadow: 0 0 0 2px rgba(78, 240, 217, 0.65), 0 0 18px rgba(78, 240, 217, 0.22);
}
.sol-hint-dst {
    outline: 2px solid rgba(62, 200, 255, 0.55);
    outline-offset: 3px;
    box-shadow: 0 0 18px rgba(62, 200, 255, 0.20);
}
.sol-hint-pulse {
    animation: solPulse 0.9s ease-in-out 1;
}
@keyframes solPulse {
    0% { transform: scale(1); box-shadow: 0 0 0 rgba(62,200,255,0); }
    50% { transform: scale(1.02); box-shadow: 0 0 18px rgba(62,200,255,0.25); }
    100% { transform: scale(1); box-shadow: 0 0 0 rgba(62,200,255,0); }
}





/* Modern Spider Footer (Dock - Portrait) */
.sol-footer {
    /* Increased height to prevent bottom clipping + safe area */
    height: calc(110px + env(safe-area-inset-bottom, 20px));
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    padding-bottom: env(safe-area-inset-bottom, 20px);
    z-index: 100;
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
}

/* Landscape Sidebar Mode */
.sol-stock-area {
    width: var(--card-w);
    height: var(--card-h);
    position: relative;
    cursor: pointer;
    transition: transform 0.1s;
    flex-shrink: 0;
}

.sol-stock-area:active {
    transform: scale(0.95);
}

.stock-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    /* Matches card radius roughly */
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
}

.stock-counter {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #ff4757;
    color: white;
    font-size: 12px;
    font-weight: bold;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    z-index: 10;
}

/* Completed Piles Area */
.sol-completed-area {
    display: flex;
    align-items: center;
    height: var(--card-h);
    width: 100px;
    /* Space for piles */
}

.app-spider.landscape .sol-completed-area {
    flex-direction: column;
    width: 100%;
    height: auto;
    min-height: 100px;
    justify-content: center;
}

/* Info Text */
.sol-info {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
}

.app-spider.landscape .sol-info {
    margin-bottom: auto;
    /* Push stock to bottom */
    text-align: center;
}


/* Card Visuals Polish */
.sol-card {
    border-radius: 8px;
    /* Smoother corners 2026 */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    /* Deeper shadow */
}

.sol-card::before {
    /* Highlight gloss */
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, transparent 40%);
    pointer-events: none;
}

/* Spider Solitaire Specifics */
.app-spider .sol-tableau {
    width: 100%;
    max-width: calc((10 * var(--card-w)) + (9 * var(--gap)));

    justify-content: center;
    /* Center the 10 columns */
    padding-bottom: 20px;
    /* Extra padding for overlap safety */
}



/* Spider Controls area (bottom/side) */
.sol-spider-controls {
    height: var(--card-h);
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 10px;
    padding-bottom: 10px;
}

/* Completed piles (Kings) */
.sol-pile.ended {
    border-color: gold;
    color: gold;
    background: rgba(255, 215, 0, 0.1);
    font-size: 24px;
}

/* Responsive Variables */
:root {
    /* Portrait: Width constrained */
    --card-w: clamp(40px, 12.5vw, 90px);

    /* 
       Landscape constraint: height is the bottleneck. 
       We need ~4 cards high visible in tableau + spacing.
       If height is 400px, card should be < 100px height (~70px width).
    */
    --card-h: calc(var(--card-w) * 1.45);
    --gap: 4px;
}



/* --- Responsive Solitaire Header (mobile-safe, no overlap) --- */
@media (max-width: 520px) {
  .sol-header {
    height: auto;
    min-height: 0;
    grid-template-columns: 1fr;
    grid-auto-rows: auto;
    justify-items: stretch;
    align-items: start;
    gap: 6px;
    padding: 6px 10px;
    padding-top: calc(env(safe-area-inset-top, 0px) + 6px);
  }

  .sol-title {
    justify-self: start;
    font-size: 12px;
    opacity: 0.9;
  }

  .sol-actions {
    justify-self: stretch;
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 2px;
    gap: 8px;
  }

  .sol-actions::-webkit-scrollbar { display: none; }

  /* Icon-first buttons on small screens to prevent wrapping/clipping */
  .sol-action-btn {
    flex: 0 0 auto;
    width: 36px;
    padding: 0;
    justify-content: center;
    gap: 0;
    border-radius: 14px;
  }
  .sol-action-label { display: none; }
}

/* Modern arcade-glass button polish */
.sol-action-btn {
  background: linear-gradient(180deg, rgba(255,255,255,0.11), rgba(255,255,255,0.06));
  box-shadow:
    0 6px 18px rgba(0,0,0,0.28),
    inset 0 1px 0 rgba(255,255,255,0.18),
    inset 0 -1px 0 rgba(0,0,0,0.18);
}
.sol-action-btn:hover {
  box-shadow:
    0 10px 24px rgba(0,0,0,0.32),
    inset 0 1px 0 rgba(255,255,255,0.22),
    inset 0 -1px 0 rgba(0,0,0,0.18);
}
.sol-action-btn:active {
  transform: translateY(1px) scale(0.99);
  box-shadow:
    0 4px 14px rgba(0,0,0,0.26),
    inset 0 1px 0 rgba(255,255,255,0.14),
    inset 0 -1px 0 rgba(0,0,0,0.22);
}
.sol-action-btn svg {
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.25));
}

/* Board */
.sol-board {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 10px;
    gap: 15px;
    /* Prevent cards from overflowing viewport */
    overflow: hidden;
    /* Center board for large screens */
    max-width: 800px;
    width: 100%;
    align-self: center;
}

/* Top Section (Stock, Waste, Foundations) */
.sol-top {
    display: flex;
    justify-content: space-between;
    height: var(--card-h);
    padding: 0 4px;
    flex-shrink: 0;
}

.sol-pile {
    width: var(--card-w);
    height: var(--card-h);
    border: 2px dashed rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.sol-pile.empty::after {
    content: '↺';
    font-size: 20px;
    color: rgba(255, 255, 255, 0.3);
}

.sol-foundations {
    display: flex;
    gap: var(--gap);
}

/* Tableau */
.sol-tableau {
    flex: 1;
    display: flex;
    justify-content: space-between;
    padding-top: 10px;
    padding-left: 4px;
    padding-right: 4px;
    /* Prevent cards from overflowing - critical for bottom clipping fix */
    overflow: hidden;
}

.sol-column {
    position: relative;
    width: var(--card-w);
    /* Constrain height to prevent overflow */
    height: 100%;
    max-height: 100%;
    overflow: hidden;
}


/* Landscape Mode Optimization - JS driven sizing now */
/* Vertical centering if height is constraining */
.app-solitaire {
    justify-content: center;
    /* Center content vertically */
}

.sol-board {
    justify-content: flex-start;
    /* Stack top-down */
    align-items: center;
    /* Center horizontally */
    margin: 0 auto;
    /* Ensure centered */
}

/* Spider (10 columns) desktop hardening:
   The generic .sol-board rules center children and clip overflow. Spider needs the board
   to stretch to the remaining width (minus sidebar) and allow the tableau to center
   without being clipped. These overrides are scoped to Spider only. */
.app-spider .sol-board {
    width: 100%;
    max-width: none;
    align-self: stretch;
    align-items: stretch;
    overflow: visible;
}

.app-spider.landscape .sol-board {
    width: calc(100% - 140px);
    max-width: none;
    margin: 0;
}

.app-spider .sol-tableau {
    width: 100%;
    justify-content: center;
    overflow: visible;
}

/* Ensure Top Section doesn't shrink awkwardly (Solitaire only: 7 columns) */
.app-solitaire:not(.app-spider) .sol-top,
.app-solitaire:not(.app-spider) .sol-tableau {
    width: 100%;
    max-width: calc((7 * var(--card-w)) + (6 * var(--gap)));
}

/* Cards */
.card {
    width: var(--card-w);
    height: var(--card-h);
    position: absolute;
    top: 0;
    left: 0;
    perspective: 1000px;
    user-select: none;
    -webkit-user-select: none;
    cursor: grab;
    border-radius: 8px;
    /* Polished 2026 */
    /* Dynamic sizing context */
    font-size: calc(var(--card-w) * 0.5);
    transition: transform 0.14s ease, filter 0.14s ease;
}

.card:active {
    cursor: grabbing;
}

.card.is-dragging {
    transform: translateY(-2px);
    filter: drop-shadow(0 10px 18px rgba(0, 0, 0, 0.5));
}

.card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.3s;
    transform-style: preserve-3d;
}

.card.flipped .card-inner {
    transform: rotateY(180deg);
}

.card-front,
.card-back{
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 8px;
    /* Polished */
    overflow: hidden;
    padding: max(6px, calc(var(--card-w) * 0.08));
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);

    /* Arcade Bevel Effect - Subtle */
    border-top: 1px solid rgba(255, 255, 255, 0.4);
    border-left: 1px solid rgba(255, 255, 255, 0.3);
    border-right: 1px solid rgba(0, 0, 0, 0.3);
    border-bottom: 2px solid rgba(0, 0, 0, 0.5);
}

.card::before {
    /* Highlight gloss for all cards */
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, transparent 40%);
    pointer-events: none;
    z-index: 2;
}

/* Back Design - Arcade Pattern */
.card-back,
.card-back-visual {
    background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
    border: 1px solid rgba(255, 255, 255, 0.1);
    width: var(--card-w);
    height: var(--card-h);
    border-radius: 8px;
    /* Polished */
}

/* Front Design */
.card-front {
    background: #fff;
    color: #000;
    transform: rotateY(180deg);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: calc(var(--card-w) * 0.1);
    /* Dynamic Padding */
    font-family: 'Courier New', Courier, monospace;
    font-weight: bold;
}

.card-front.red {
    color: #d00;
}

.card-front.black {
    color: #000;
}

.card-corner {
    display: flex;
    flex-direction: column;
    align-items: center;
    line-height: 1;
    font-size: calc(var(--card-w) * 0.34);
    /* Scalable Font */
}

.card-corner.bottom-right {
    transform: rotate(180deg);
}

/* Ensure rank/suit corners never clip on small cards */
.card-front { position: absolute; inset: 0; }
.card-front { display: block; }
.card-corner.top-left {
    position: absolute;
    top: max(7px, calc(var(--card-w) * 0.09));
    left: max(7px, calc(var(--card-w) * 0.09));
}
.card-corner.bottom-right {
    position: absolute;
    bottom: max(7px, calc(var(--card-w) * 0.09));
    right: max(7px, calc(var(--card-w) * 0.09));
}

/* Keep center pip clear of corners */
.card-center { pointer-events: none; }

/* Light theme support for card games */
body.theme-light .app-solitaire,
body.theme-light .app-spider {
    background-color: rgba(245, 248, 255, 0.92);
    background-image:
        radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.06) 100%),
        repeating-linear-gradient(45deg, rgba(0, 0, 0, 0.025) 0px, rgba(0, 0, 0, 0.025) 1px, transparent 1px, transparent 8px);
}
body.theme-light .sol-header,
body.theme-light .sol-footer,
body.theme-light .app-spider.landscape .sol-footer {
    background: rgba(255, 255, 255, 0.7);
    border-color: rgba(0, 0, 0, 0.08);
}
body.theme-light body.theme-light .sol-info { color: rgba(14, 20, 27, 0.65); text-shadow: none; }

/* Ensure footer content clears iOS bottom bars */
.sol-footer {
    padding-bottom: max(env(safe-area-inset-bottom, 0px), 14px);
}

.card-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: calc(var(--card-w) * 0.8);
    /* Scalable Symbol */
}

/* Ghost Dragging */
.drag-ghost {
    position: fixed;
    pointer-events: none;
    z-index: 1000;
    filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.6));
    opacity: 0.95;
}


/* Settings Popover (shared) */
.sol-settings-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
    display: flex;
    align-items: flex-start;
    justify-content: flex-end;
    padding: calc(var(--sol-header-h) + env(safe-area-inset-top, 0px) + 10px) 10px 10px 10px;
    z-index: 200;
}
.sol-settings-overlay.hidden { display: none; }

.sol-settings-popover {
    width: min(240px, 70vw);
    background: rgba(6, 14, 28, 0.72);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 16px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.5);
    overflow: hidden;
}
.sol-settings-title {
    padding: 10px 12px;
    font-weight: 800;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-size: 12px;
    color: rgba(230,241,255,0.9);
    border-bottom: 1px solid rgba(255,255,255,0.08);
}
.sol-settings-item {
    width: 100%;
    padding: 12px;
    background: transparent;
    border: none;
    color: rgba(230,241,255,0.9);
    text-align: left;
    cursor: pointer;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    transition: background 0.12s ease;
}
.sol-settings-item:hover { background: rgba(62,200,255,0.08); }
.sol-settings-item.secondary { border-bottom: none; color: rgba(230,241,255,0.75); }

/* High contrast mode (cards only) */
.app-solitaire.cards-contrast .card-front,
.app-solitaire.cards-contrast .card-back {
    border-color: rgba(0,0,0,0.65);
    box-shadow: 0 6px 14px rgba(0,0,0,0.55);
}
.app-solitaire.cards-contrast .card-front { background: #ffffff; }
.app-solitaire.cards-contrast .card-front.red { color: #b00000; }
.app-solitaire.cards-contrast .card-front.black { color: #000000; }

/* Subtle drag elevation */
.card.dragging,
.drag-ghost {
    filter: drop-shadow(0 14px 26px rgba(0, 0, 0, 0.65));
}


.sol-pile, .sol-stock-area, .card { transition: width 160ms ease, height 160ms ease, transform 160ms ease; }


/* =========================================================
   Spider overrides (desktop/landscape)
   NOTE: This block MUST live after the base `.sol-board` rule,
   otherwise later generic rules will re-introduce max-width/overflow
   and cause the 10-column tableau to clip/shift.
   ========================================================= */
.app-spider{
  /* Single source of truth for sidebar width */
  --spider-sidebar-w: 140px;
}

/* Sidebar becomes a right dock in landscape/desktop */
.app-spider.landscape .sol-footer{
  position:absolute;
  right:0;
  top:calc(var(--sol-header-h) + env(safe-area-inset-top, 0px));
  bottom:0;
  width:var(--spider-sidebar-w);
  height:auto;
  flex-direction:column-reverse; /* Stock at bottom */
  justify-content:flex-start;
  padding:20px 10px;
  padding-right:max(10px, env(safe-area-inset-right));
  border-top:none;
  border-left:1px solid rgba(255,255,255,0.10);
  gap:20px;
  background:rgba(0,0,0,0.80);
}

/* Make the board occupy the remaining width to the left of the sidebar.
   We also force-stretch it to prevent centering offsets. */
.app-spider.landscape .sol-board{
  width:calc(100% - var(--spider-sidebar-w)) !important;
  max-width:none !important;
  align-self:stretch !important;
  overflow:visible !important;
  display:flex;
  justify-content:center;
}

/* Spider uses 10 columns; do NOT let base rules (tuned for 7 columns) constrain it. */
.app-spider .sol-board{
  max-width:none !important;
  width:100% !important;
  align-self:stretch !important;
  overflow:visible !important;
}

.app-spider .sol-tableau{
  width:100% !important;
  max-width:calc((10 * var(--card-w)) + (9 * var(--gap))) !important;
  justify-content:center;
  gap:var(--gap);
  padding-left:0;
  padding-right:0;
  overflow:visible !important;
}

.app-spider.landscape .sol-tableau{
  margin:0 auto;
}




/* Tighten spacing in small-height landscape to maximize play area */
@media (orientation: landscape) and (max-height: 520px) {
    .sol-board { padding: 6px; gap: 10px; }
    .sol-top { padding: 0 2px; }
    .sol-tableau { padding-top: 6px; }
}

